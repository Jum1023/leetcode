#include <stdbool.h>
#include <stdlib.h>

// DSU
typedef struct DSU
{
	int *parent;
	int *rank;
	int *malware;
} DSU;

DSU *dsu_init(int N)
{
	DSU *dsu = (DSU *)malloc(sizeof(DSU));
	dsu->parent = (int *)malloc(sizeof(int) * N);
	dsu->rank = (int *)malloc(sizeof(int) * N);
	dsu->malware = (int *)malloc(sizeof(int) * N);
	for (int i = 0; i < N; ++i)
	{
		dsu->parent[i] = i;
		dsu->rank[i] = 1;
		dsu->malware[i] = 0;
	}
	return dsu;
}

void dsu_release(DSU *dsu)
{
	if (dsu)
	{
		if (dsu->parent)
			free(dsu->parent);
		if (dsu->rank)
			free(dsu->rank);
		if (dsu->malware)
			free(dsu->malware);
		free(dsu);
	}
}

int dsu_find(DSU *dsu, int x)
{
	if (x != dsu->parent[x])
		dsu->parent[x] = dsu_find(dsu, dsu->parent[x]);
	return dsu->parent[x];
}

bool dsu_union(DSU *dsu, int x, int y)
{
	int xr = dsu_find(dsu, x), yr = dsu_find(dsu, y);
	if (xr == yr)
		return false;
	dsu->parent[yr] = xr;
	dsu->rank[xr] += dsu->rank[yr];
	return true;
}

void dsu_addmalware(DSU *dsu, int x)
{
	++dsu->malware[dsu_find(dsu, x)];
}

int dsu_getmaxspreadnode(DSU *dsu, int x)
{
	int p = dsu_find(dsu, x);
	if (dsu->malware[p] == 1)
		return dsu->rank[p];
	return 0;
}

int minMalwareSpread(int **graph, int graphSize, int *graphColSize, int *initial, int initialSize)
{
	DSU *dsu = dsu_init(graphSize);
	for (int i = 0; i < graphSize; ++i)
	{
		for (int j = i + 1; j < *graphColSize; ++j)
		{
			if (graph[i][j] == 1)
				dsu_union(dsu, i, j);
		}
	}
	for (int i = 0; i < initialSize; ++i)
		dsu_addmalware(dsu, initial[i]);
	int infected = -1, node = 0;
	for (int i = 0; i < initialSize; ++i)
	{
		int spread = dsu_getmaxspreadnode(dsu, initial[i]);
		if (spread > infected)
		{
			infected = spread;
			node = initial[i];
		}
		else if (spread == infected && initial[i] < node)
			node = initial[i];
	}
	return node;
}