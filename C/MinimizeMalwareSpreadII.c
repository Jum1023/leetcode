#include <string.h>

void dfs(int **graph, int graphSize, int *seen, int node)
{
	for (int i = 0; i < graphSize; ++i)
	{
		if (graph[node][i] == 1 && seen[i] == 0)
		{
			seen[i] = 1;
			dfs(graph, graphSize, seen, i);
		}
	}
}

int minMalwareSpread(int **graph, int graphSize, int *graphColSize, int *initial, int initialSize)
{
	int seen[graphSize], infectedBy[graphSize][2]; //{count, malware node}
	memset(infectedBy, 0, sizeof(infectedBy));
	memset(seen, 0, sizeof(seen));
	for (int i = 0; i < initialSize; ++i)
		seen[initial[i]] = 1;
	for (int i = 0; i < initialSize; ++i)
	{
		int seen_copy[graphSize];
		memcpy(seen_copy, seen, sizeof(seen));
		dfs(graph, graphSize, seen_copy, initial[i]);
		for (int j = 0; j < graphSize; ++j)
		{
			if (seen_copy[j] == 1)
			{
				++infectedBy[j][0];
				infectedBy[j][1] = initial[i];
			}
		}
	}

	int contribution[graphSize];
	memset(contribution, 0, sizeof(contribution));
	for (int i = 0; i < graphSize; ++i)
	{
		if (infectedBy[i][0] == 1)
			++contribution[infectedBy[i][1]];
	}
	int res = -1, count = -1;
	for (int i = 0; i < initialSize; ++i)
	{
		if (contribution[initial[i]] > count || (contribution[initial[i]] == count && initial[i] < res))
		{
			res = initial[i];
			count = contribution[initial[i]];
		}
	}
	return res;
}